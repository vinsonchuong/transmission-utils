#!/bin/bash -e
ARGS=$(getopt -o  ho: -l help,output: -- "$@")
eval set -- $ARGS

while [ $# -gt 0 ]
do
	case "$1" in
		-h|--help)
			SHOW_HELP=yes
			shift
			;;
		-o|--output)
			DIRECTORY="$2"
			shift
			;;
		--)
			shift
			break
			;;
	esac
done

if [ -n "$SHOW_HELP" ]
then
	HTML=$(cat docs/transmission-get.md | ronn -5 | sed 's/<var>\([^<]*\)<\/var>/\&lt;\1\&gt;/g')
	echo "$HTML" \
		| xidel -q --css '.man-name' -
	echo
	echo 'Usage:'
	echo "$HTML" \
		| xidel -q --css '#SYNOPSIS + p' - \
		| sed 's/^/  /'
	echo
	echo 'Options:'
	echo "$HTML" \
		| xidel -q --css '#OPTIONS + dl > *' - \
		| paste -d ':' - - \
		| column -t -s ':' \
		| sed 's/^/ /'
	exit
fi

TMP=$(mktemp -d)
tee $TMP/settings.json <<EOF
{
	"idle-seeding-limit-enabled": true,
	"idle-seeding-limit": 0
}
EOF
transmission-cli -g $TMP "${!#}"
rm -rf $TMP
